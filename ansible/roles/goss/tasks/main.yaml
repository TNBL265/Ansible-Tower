- name: Set fact for Ubuntu20
  set_fact:
    git_url: "https://bitbucket.it.keysight.com/scm/kps011/ansible-lockdown-ubuntu20-audit.git"
    branch: "master"
  when: ansible_distribution == "Ubuntu" and ansible_distribution_version == "20.04"

- name: Set fact for Amazon2
  set_fact:
    git_url: "https://bitbucket.it.keysight.com/scm/kps011/ansible-lockdown-amazon2-audit.git"
    branch: "dev"
  when: ansible_distribution == "Amazon" and ansible_distribution_version == "2"

- name: Set fact for RHEL 8
  set_fact:
    git_url: "https://bitbucket.it.keysight.com/scm/kps011/ansible-lockdown-rhel8-audit.git"
    branch: "dev"
  when: ansible_distribution == "RedHat" and ansible_distribution_version == "8.0"

- name: Debug
  debug:
    msg: "Clone git from {{ git_url }}, branch {{ branch }}"

#- name: Clone audit repo
#  git:
#    repo: https://bitbucket.it.keysight.com/scm/kps011/ansible-lockdown-ubuntu20-audit.git
#    dest: /var/tmp
#    single_branch: yes
#    version: dev
#
#- name: Run goss audit
#  shell: run_audit.sh
#  args:
#    chdir: /var/tmp/ansible-lockdown-ubuntu20-audit
#  register:
#    goss_out
#
#- name: Copy back json report
#  copy:
#    src: goss_out.stdout.find(.json)
#    dest: {{ ansible_dir }}
#
#- name: Run conversion python
#  script: ./willis.py goss_out
#  args:
#    executable: {{ ansible_python_interpreter }}